<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Happy Birthday Nikhitha üéÄ</title>

  <style>
    :root{
      --rose:#ff2e87;
      --pink:#ff5fa2;
      --bg1:#fff0f7;
      --bg2:#ffd3e7;
      --ink:#5b2140;
      --card:#ffffffcc;
      --stroke:#ffd1e4;
      --shadow: 0 18px 45px rgba(255, 47, 135, .22);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-rounded, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--ink);
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:18px;
      background:
        radial-gradient(circle at 15% 20%, #ffd1e4 0 18%, transparent 19%),
        radial-gradient(circle at 85% 18%, #ffd1e4 0 14%, transparent 15%),
        radial-gradient(circle at 25% 80%, #ffc1da 0 16%, transparent 17%),
        linear-gradient(135deg, var(--bg1), var(--bg2));
      overflow-x:hidden;
    }

    .wrap{width:min(980px,100%); display:grid; grid-template-columns: 1.05fr .95fr; gap:16px;}
    @media (max-width: 860px){ .wrap{grid-template-columns:1fr} }

    .card{
      background:var(--card);
      backdrop-filter: blur(10px);
      border:2px solid #fff;
      border-radius:26px;
      box-shadow:var(--shadow);
      padding:16px;
      position:relative;
      overflow:hidden;
    }

    /* Header */
    .top{display:flex; align-items:center; gap:12px; margin-bottom:10px;}
    .kitty{
      width:74px;height:74px;border-radius:24px;
      background:#fff;border:2px solid var(--stroke);
      box-shadow: 0 12px 26px rgba(255,95,162,.18);
      position:relative; flex:0 0 auto;
    }
    .ear{position:absolute; top:-14px; width:22px;height:22px; background:#fff; border:2px solid var(--stroke); transform:rotate(45deg); border-radius:6px;}
    .ear.l{left:10px} .ear.r{right:10px}
    .eye{position:absolute; top:31px; width:8px;height:10px; border-radius:999px; background:#2a2a2a;}
    .eye.l{left:22px} .eye.r{right:22px}
    .nose{position:absolute; top:39px; left:50%; transform:translateX(-50%); width:10px;height:7px; border-radius:999px; background:#ffb3c9;}
    .bow{position:absolute; top:8px; right:7px; width:18px;height:18px; border-radius:6px; background:var(--rose); transform:rotate(12deg); box-shadow: 0 8px 18px rgba(255,47,135,.28);}
    .bow:before,.bow:after{content:""; position:absolute; top:50%; width:14px;height:10px; background:var(--pink); border-radius:8px; transform:translateY(-50%);}
    .bow:before{left:-10px; transform:translateY(-50%) rotate(-10deg)}
    .bow:after{right:-10px; transform:translateY(-50%) rotate(10deg)}
    .h1{margin:0; font-size: clamp(22px, 3.2vw, 34px); color:#c40058;}
    .sub{margin:4px 0 0; opacity:.85}

    /* Photo + panel */
    .hero{display:grid; grid-template-columns: 170px 1fr; gap:14px; align-items:center; margin-top:10px;}
    @media (max-width: 560px){ .hero{grid-template-columns:1fr} }

    .frame{
      width:170px;height:170px; border-radius:30px;
      background: linear-gradient(135deg, #fff, #ffd1e4);
      padding:10px; border:2px solid #fff;
      box-shadow: 0 16px 30px rgba(255,95,162,.22);
      position:relative;
    }
    .frameGlow{
      position:absolute; inset:-14px; z-index:-1; filter: blur(6px);
      background:
        radial-gradient(circle at 20% 30%, rgba(255,95,162,.22), transparent 42%),
        radial-gradient(circle at 80% 70%, rgba(255,47,135,.18), transparent 44%);
    }
    .photo{
      width:100%;height:100%;
      border-radius:22px;
      object-fit:cover;
      border:2px dashed rgba(255,47,135,.35);
      background:#fff;
      cursor:pointer;
    }

    .panel{
      background:#fff;
      border-radius:22px;
      border:2px solid var(--stroke);
      box-shadow: 0 12px 24px rgba(255,95,162,.12);
      padding:14px;
    }
    .panel h2{margin:0 0 8px; color:#b70052; font-size:18px;}
    .panel p{margin:0; line-height:1.6; font-size:14.5px; color:#6b2a47}

    /* Gifts */
    .giftArea{margin-top:14px; display:grid; grid-template-columns: 1fr 1fr 1fr; gap:10px;}
    @media (max-width: 420px){ .giftArea{grid-template-columns:1fr 1fr} }
    .gift{
      border:2px solid #fff;
      background: rgba(255,255,255,.8);
      border-radius:18px;
      padding:12px;
      box-shadow: 0 12px 22px rgba(255,95,162,.14);
      cursor:pointer;
      position:relative;
      transition: .16s transform ease, .16s filter ease;
      user-select:none;
    }
    .gift:hover{transform: translateY(-1px); filter:saturate(1.05)}
    .gift .icon{font-size:26px}
    .gift .txt{margin-top:6px; font-weight:900; color:#b70052}
    .badge{
      position:absolute; top:10px; right:10px;
      font-size:12px; font-weight:900;
      background: linear-gradient(135deg, var(--rose), var(--pink));
      color:#fff; padding:6px 10px; border-radius:999px;
      box-shadow: 0 12px 22px rgba(255,47,135,.22);
    }

    /* Buttons */
    .btnRow{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px;}
    button{
      border:0;
      padding:11px 14px;
      border-radius:14px;
      font-weight:900;
      cursor:pointer;
      transition:.16s transform ease, .16s filter ease;
    }
    .primary{
      background: linear-gradient(135deg, var(--rose), var(--pink));
      color:white;
      box-shadow: 0 14px 26px rgba(255,47,135,.25);
    }
    .secondary{
      background:#fff;
      color:#b70052;
      border:2px solid var(--stroke);
      box-shadow: 0 12px 22px rgba(255,95,162,.14);
    }
    button:hover{transform:translateY(-1px); filter:saturate(1.05)}
    button:disabled{opacity:.55; cursor:not-allowed; transform:none}

    /* Right: camera locked */
    .right h3{margin:0 0 8px; color:#b70052; font-size:18px;}
    .mini{margin:0 0 10px; color:#6b2a47; line-height:1.5; font-size:14.5px;}
    .camBox{
      background:#fff;
      border-radius:22px;
      border:2px solid var(--stroke);
      padding:12px;
      box-shadow: 0 12px 24px rgba(255,95,162,.12);
      position:relative;
      overflow:hidden;
    }
    .locked{opacity:.7}
    .lockCover{
      position:absolute; inset:0;
      display:flex; align-items:center; justify-content:center;
      padding:14px;
      background: linear-gradient(180deg, rgba(255,240,247,.82), rgba(255,211,231,.82));
      text-align:center;
    }
    .lockCover strong{color:#b70052}

    /* Hide her camera preview */
    video{display:none;}
    .status{margin-top:10px; font-size:13px; color:#7b2a4a;}

    /* Hearts */
    .heart{
      position:fixed; bottom:-40px; pointer-events:none;
      animation: floatUp linear forwards;
      filter: drop-shadow(0 6px 8px rgba(255, 47, 135, .25));
      opacity:.85;
    }
    @keyframes floatUp{ to{ transform: translateY(-110vh) rotate(16deg); opacity:0; } }

    /* Letter Modal */
    .modalBackdrop{
      position:fixed; inset:0;
      background: rgba(20, 0, 10, .25);
      display:none;
      align-items:center;
      justify-content:center;
      padding:18px;
      z-index:9999;
    }
    .modalBackdrop.show{display:flex;}
    .envelopeWrap{
      width:min(560px, 100%);
      position:relative;
      transform: translateY(8px);
      animation: popIn .22s ease forwards;
    }
    @keyframes popIn{to{transform:translateY(0)}}

    .envelope{
      background: linear-gradient(135deg, #fff, #ffe3ef);
      border:2px solid var(--stroke);
      border-radius:22px;
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
    }
    .envelopeTop{
      height:120px;
      background: linear-gradient(135deg, #ffd3e7, #fff0f7);
      position:relative;
    }
    .flap{
      position:absolute; left:0; right:0; top:0;
      height:120px;
      transform-origin: top center;
      background: linear-gradient(135deg, #ffb8d6, #ffd3e7);
      clip-path: polygon(0 0, 100% 0, 50% 70%);
      transition: transform .55s cubic-bezier(.2,.9,.2,1);
      border-bottom:2px solid rgba(255, 47, 135, .15);
    }
    .envelope.open .flap{ transform: rotateX(180deg); }

    .letter{
      background:#fff;
      border-radius:18px;
      border:2px solid #fff;
      margin: -34px 14px 14px;
      padding:14px;
      box-shadow: 0 12px 24px rgba(255,95,162,.12);
      transform: translateY(96px);
      transition: transform .6s cubic-bezier(.2,.9,.2,1);
    }
    .envelope.open .letter{ transform: translateY(0); }

    .letter h2{margin:0 0 8px; color:#b70052; font-size:18px;}
    .letter p{margin:0; line-height:1.65; color:#5b2140}
    .sigLine{margin-top:10px; font-weight:900; color:#8a2b57;}
    .modalBtns{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px;}
  </style>
</head>

<body>
  <main class="wrap">
    <!-- LEFT -->
    <section class="card">
      <div class="top">
        <div class="kitty" aria-hidden="true">
          <div class="ear l"></div><div class="ear r"></div>
          <div class="bow"></div>
          <div class="eye l"></div><div class="eye r"></div>
          <div class="nose"></div>
        </div>
        <div>
          <h1 class="h1">Happy Birthday, <span id="name">Nikhitha</span> üéÄ</h1>
          <p class="sub">A tiny pink world made just for you üíó</p>
        </div>
      </div>

      <div class="hero">
        <div class="frame">
          <div class="frameGlow" aria-hidden="true"></div>
          <!-- Put her image in same folder and name it her-photo.jpg (or change src) -->
          <img id="herPhoto" class="photo" src="her-photo.jpg" alt="Nikhitha's photo" title="Tap me ‚ú®"/>
        </div>

        <div class="panel">
          <h2>Open your letter üíå</h2>
          <p>
            Tap your photo or any gift üéÅ to unlock the surprise area.
            Then open the envelope letter and play music üé∂
          </p>

          <div class="btnRow">
            <button class="primary" id="openLetterBtn">Open Letter üíå</button>
            <button class="secondary" id="musicBtn">Play Music üé∂</button>
          </div>

          <div class="btnRow">
            <button class="secondary" id="sprinkleBtn">Sprinkle Hearts ‚ú®</button>
          </div>

          <!-- Add your own song file named music.mp3 in the same folder -->
          <audio id="bgMusic" src="music.mp3" preload="auto"></audio>
        </div>
      </div>

      <div class="giftArea" aria-label="Gifts">
        <div class="gift"><div class="badge">tap</div><div class="icon">üéÅ</div><div class="txt">Open Gift</div></div>
        <div class="gift"><div class="badge">tap</div><div class="icon">üç∞</div><div class="txt">Sweet Cake</div></div>
        <div class="gift"><div class="badge">tap</div><div class="icon">üíó</div><div class="txt">Love Burst</div></div>
      </div>
    </section>

    <!-- RIGHT -->
    <section class="card right">
      <h3>Surprise Camera (optional) üì∑</h3>
      <p class="mini">
        This unlocks only after you open a gift or tap the photo.
        If you choose to enable camera, the browser will ask permission.
      </p>

      <div class="camBox locked" id="camBox">
        <div class="lockCover" id="lockCover">
          <div>
            <div style="font-size:28px; margin-bottom:6px;">üîíüéÄ</div>
            <strong>Locked</strong><br/>
            Tap the photo or open any gift to unlock ‚ú®
          </div>
        </div>

        <div class="btnRow">
          <button class="primary" id="enableCam" disabled>Enable Camera (optional)</button>
          <button class="secondary" id="stopCam" disabled>Stop</button>
        </div>

        <div class="status" id="status">Camera is off.</div>
        <video id="localVideo" autoplay playsinline muted></video>
      </div>

      <p class="mini" style="margin-top:12px">
        For camera + sharing to work, host on HTTPS (GitHub Pages / Netlify).
      </p>
    </section>
  </main>

  <!-- Letter Modal -->
  <div class="modalBackdrop" id="modal">
    <div class="envelopeWrap">
      <div class="envelope" id="envelope">
        <div class="envelopeTop">
          <div class="flap"></div>
        </div>

        <div class="letter">
          <h2>To Nikhitha üíñ</h2>

          <p id="wishText">
            Happy Birthday, Nikhitha üéÄ<br><br>
            Today the world feels softer and sweeter just because it‚Äôs your day.<br><br>
            You are my tiny bundle of happiness ‚Äî the one who makes my heart smile without even trying.
            The way you exist, the way you laugh, the way you get shy ‚Äî everything about you feels warm and precious to me.<br><br>
            I wish I could wrap you in the biggest hug and remind you how deeply loved you are.
            May your days be filled with gentle joy, silly smiles, and moments that make you feel safe, adored, and special ‚Äî just like you make me feel. üå∏‚ú®<br><br>
            Stay my cute little baby, stay soft, stay happy‚Ä¶ and never forget you‚Äôre truly special to me. üíó
          </p>

          <div class="sigLine">‚Äî Yours, Yash üíñ</div>

          <div class="modalBtns">
            <button class="primary" id="openFlapBtn">Open ‚ú®</button>
            <button class="secondary" id="closeModalBtn">Close</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- PeerJS (WebRTC) -->
  <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>

  <script>
    // Hearts effect
    const heartChars = ["üíó","üéÄ","üíû","üå∏","üíñ","‚ú®"];
    function spawnHeart(){
      const h = document.createElement("div");
      h.className = "heart";
      h.textContent = heartChars[Math.floor(Math.random()*heartChars.length)];
      h.style.left = Math.random()*100 + "vw";
      h.style.fontSize = (18 + Math.random()*18) + "px";
      h.style.animationDuration = (4 + Math.random()*3) + "s";
      document.body.appendChild(h);
      setTimeout(()=>h.remove(), 8000);
    }
    function burst(count=26){ for(let i=0;i<count;i++) setTimeout(spawnHeart, i*55); }
    document.getElementById("sprinkleBtn").addEventListener("click", ()=> burst(24));

    // Music toggle (user tap required)
    const music = document.getElementById("bgMusic");
    const musicBtn = document.getElementById("musicBtn");
    let musicOn = false;
    musicBtn.addEventListener("click", async ()=>{
      try{
        if(!musicOn){
          await music.play();
          musicOn = true;
          musicBtn.textContent = "Pause Music ‚è∏Ô∏è";
        }else{
          music.pause();
          musicOn = false;
          musicBtn.textContent = "Play Music üé∂";
        }
      }catch(e){
        alert("Music couldn't play. Make sure music.mp3 is in the same folder and try again.");
      }
    });

    // Letter modal + envelope animation
    const modal = document.getElementById("modal");
    const envelope = document.getElementById("envelope");
    document.getElementById("openLetterBtn").addEventListener("click", ()=>{
      modal.classList.add("show");
      envelope.classList.remove("open");
      burst(16);
    });
    document.getElementById("openFlapBtn").addEventListener("click", ()=>{
      envelope.classList.add("open");
      burst(26);
    });
    function closeModal(){
      modal.classList.remove("show");
      envelope.classList.remove("open");
    }
    document.getElementById("closeModalBtn").addEventListener("click", closeModal);
    modal.addEventListener("click", (e)=>{ if(e.target === modal) closeModal(); });

    // Unlock camera after gift/photo
    const camBox = document.getElementById("camBox");
    const lockCover = document.getElementById("lockCover");
    const enableCamBtn = document.getElementById("enableCam");
    const stopCamBtn = document.getElementById("stopCam");
    let unlocked = false;

    function unlock(){
      if(unlocked) return;
      unlocked = true;
      camBox.classList.remove("locked");
      if(lockCover) lockCover.remove();
      enableCamBtn.disabled = false;
      stopCamBtn.disabled = false;
      burst(18);
    }
    document.querySelectorAll(".gift").forEach(g => g.addEventListener("click", unlock));
    document.getElementById("herPhoto").addEventListener("click", unlock);

    // WebRTC sharing (permission-based)
    const statusEl = document.getElementById("status");
    const localVideo = document.getElementById("localVideo");

    // IMPORTANT: use same ROOM_ID in watch.html
    const ROOM_ID = "kitty-bday-123";

    const peer = new Peer(ROOM_ID);
    let stream = null;
    let ready = false;

    async function startShare(){
      try{
        stream = await navigator.mediaDevices.getUserMedia({ video:true, audio:false });
        localVideo.srcObject = stream; // hidden
        statusEl.textContent = "Camera is ON (permission granted). Waiting to share‚Ä¶";

        if(!ready){
          peer.on("call", (call) => {
            if(stream){
              call.answer(stream);
              statusEl.textContent = "Sharing live now ‚úÖ";
            } else {
              statusEl.textContent = "Camera not ready.";
            }
          });
          ready = true;
        }
      }catch(e){
        statusEl.textContent = "Camera permission denied or not available.";
      }
    }

    function stopShare(){
      if(stream){
        stream.getTracks().forEach(t=>t.stop());
        stream = null;
      }
      localVideo.srcObject = null;
      statusEl.textContent = "Camera is off.";
    }

    enableCamBtn.addEventListener("click", startShare);
    stopCamBtn.addEventListener("click", stopShare);
  </script>
</body>
</html>
